# 다중 이미지 처리 기능 기획안

## 1. 개요

Photo Frame Maker에 **다중 이미지 처리** 기능을 추가합니다.
최대 10장의 사진을 한 번에 업로드하고, 동일한 프레임 설정을 일괄 적용한 뒤,
2장 이상일 경우 **ZIP 압축파일**로 한번에 다운로드할 수 있습니다.

---

## 2. 핵심 요구사항

| # | 요구사항 | 상세 |
|---|---------|------|
| R1 | 최대 10장 첨부 | 한 번에 여러 파일 선택 가능, 추가 업로드로 누적 가능 (최대 10장) |
| R2 | 일괄 프레임 적용 | 비율·크기·두께·색상 설정이 모든 이미지에 동일하게 적용 |
| R3 | 개별 위치 조정 | 각 사진별 드래그 위치(offset)는 개별 관리 |
| R4 | ZIP 다운로드 | 2장 이상 처리 시 `.zip` 압축파일로 일괄 다운로드 |
| R5 | 단일 이미지 호환 | 1장일 때는 기존과 동일하게 단일 PNG 다운로드 |

---

## 3. 데이터 모델 변경

### Before (단일 이미지)
```js
this.image = null;
this.imageUrl = null;
this.fileName = '';
this.fileSize = 0;
this.imageOffset = { x: 0, y: 0 };
```

### After (이미지 배열)
```js
this.images = [];          // ImageItem 배열, 최대 10개
this.currentIndex = 0;     // 현재 선택/편집 중인 이미지 인덱스

// ImageItem 구조
{
  image: HTMLImageElement,   // 로드된 이미지 객체
  imageUrl: string,          // Object URL
  fileName: string,          // 원본 파일명
  fileSize: number,          // 파일 크기 (bytes)
  imageOffset: { x: 0, y: 0 }, // 개별 드래그 위치
  exifData: object | null    // EXIF 메타데이터
}
```

편의 getter:
```js
get currentImage() { return this.images[this.currentIndex] || null; }
get imageCount() { return this.images.length; }
get hasMultipleImages() { return this.images.length > 1; }
```

---

## 4. UI 변경

### 4-1. 업로드 영역

- `<input type="file">` 에 `multiple` 속성 추가
- 드래그 앤 드롭: 여러 파일 동시 드롭 지원
- 클립보드 붙여넣기(Ctrl+V): 단일 이미지 지원 (기존과 동일)
- **10장 초과 시**: 앞의 10장만 사용, 토스트 알림으로 "최대 10장까지 가능합니다" 표시
- 이미 이미지가 있는 상태에서 추가 업로드 시 배열에 누적 (합산 10장 제한)

### 4-2. 썸네일 스트립

프리뷰 캔버스 아래에 가로 스크롤 가능한 썸네일 바를 추가합니다.

```
┌─────────────────────────────────────┐
│          프리뷰 캔버스               │
└─────────────────────────────────────┘
[ 썸1 ] [ 썸2 ] [ 썸3 ] ... [ + ]  2/3
```

- **크기**: 썸네일 56×56px, 선택된 항목에 파란 테두리(2px)
- **추가 버튼**: `[ + ]` 버튼으로 추가 업로드 (10장 미만일 때만 표시)
- **카운터**: 우측 끝에 `현재/전체` 표시 (예: `2/3`)
- **삭제**: 각 썸네일에 `×` 버튼 (hover 시 표시)
- **표시 조건**: 이미지 2장 이상일 때만 표시
- **모바일**: 동일한 썸네일 스트립, 터치 스크롤 지원

### 4-3. 사이드바 / 모바일 사진 탭

- 현재 선택된 이미지의 파일 정보 및 EXIF 표시
- "사진 삭제" → 현재 선택된 이미지만 배열에서 제거
- "사진 추가" → 추가 업로드 트리거

### 4-4. 프레임 설정 (기존과 동일)

프레임 관련 설정 변경 시 **모든 이미지에 일괄 적용**:
- 캔버스 비율 변경 → 전체 적용 + 모든 이미지 offset 초기화
- 캔버스 크기 변경 → 전체 적용
- 프레임 두께 변경 → 전체 적용 + 모든 이미지 offset 초기화
- 프레임 색상 변경 → 전체 적용

### 4-5. 프리뷰 모드

| 모드 | 동작 |
|------|------|
| 기본 | 현재 선택된 이미지의 프레임 결과 표시 |
| 피드 | 현재 선택된 이미지의 Instagram 피드 목업 |
| 프로필 | 업로드된 이미지들로 3×3 그리드 채움 (부족한 칸은 플레이스홀더) |

---

## 5. 다운로드 로직 변경

### 5-1. 이미지 1장 → 기존과 동일

- 단일 PNG 파일 다운로드
- 파일명: `원본이름_pfm.png`
- 모바일: Web Share API / 롱프레스 저장

### 5-2. 이미지 2장 이상 → ZIP 압축파일

- **JSZip 라이브러리** 사용 (CDN)
- 각 이미지를 오프스크린 캔버스에서 개별 렌더링 → PNG Blob 생성
- 모든 PNG를 ZIP에 추가
- ZIP 파일 다운로드

```
다운로드 파일: photoframe_3장_pfm.zip
├── photo1_pfm.png
├── photo2_pfm.png
└── photo3_pfm.png
```

**ZIP 생성 플로우:**
```
[다운로드 클릭]
    ↓
[프로그레스 바 표시: "이미지 처리 중... (1/3)"]
    ↓
[각 이미지별 오프스크린 캔버스 렌더링 → PNG Blob]
    ↓
[JSZip에 모든 Blob 추가]
    ↓
[ZIP Blob 생성]
    ↓
[다운로드 트리거 + 프로그레스 완료]
```

**모바일 (2장 이상):**
- ZIP 다운로드 동일 적용
- Web Share API는 현재 선택된 이미지 1장만 공유 가능 (별도 "공유" 버튼)

### 5-3. 다운로드 버튼 UI

- 1장: `다운로드` (기존)
- 2장+: `모두 다운로드 (ZIP)` 로 라벨 변경
- 처리 중 프로그레스 바 표시 (특히 대용량/다수 이미지 시 UX 개선)

---

## 6. 의존성 추가

| 라이브러리 | 용도 | 로딩 방식 |
|-----------|------|----------|
| [JSZip](https://stuk.github.io/jszip/) | ZIP 파일 생성 | CDN (`<script>` 태그) |

```html
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
```

> JSZip은 브라우저 전용, 순수 JS 라이브러리로 별도 빌드 과정 불필요.

---

## 7. 주요 로직 변경 포인트

| 영역 | 변경 내용 |
|------|-----------|
| `loadImage()` | `this.images[]` 에 push, 10장 제한 체크, 썸네일 갱신 |
| `removeImage()` | 배열에서 splice, currentIndex 보정, 썸네일 갱신 |
| `render()` | `this.currentImage`의 image/offset 사용 |
| `drawImage()` | `this.currentImage.imageOffset` 사용 |
| `updateInfo()` | `this.currentImage`의 원본 크기/EXIF 표시 |
| `updateUploadUI()` | 현재 선택 이미지 정보 + 썸네일 스트립 갱신 |
| `download()` | 1장이면 기존, 2장+ 이면 ZIP 생성 후 다운로드 |
| `onDrag*()` | `this.currentImage.imageOffset` 조작 |
| 비율/두께 변경 | 모든 이미지의 offset 초기화 |
| 프로필 모드 | 실제 업로드 이미지들로 그리드 채움 |

---

## 8. 구현 순서

### Phase 1: 데이터 모델 전환
1. `this.image` → `this.images[]` 배열 + `currentIndex` + getter 전환
2. 기존 단일 이미지 참조하는 모든 코드를 `this.currentImage` 기반으로 변경
3. 기존 기능이 1장 기준으로 정상 동작하는지 검증

### Phase 2: 다중 업로드
4. `<input>` 에 `multiple` 속성 추가
5. `loadImage()` → 배열 push + 10장 제한 로직
6. 드래그 앤 드롭 다중 파일 처리
7. `removeImage()` → 배열 splice + 인덱스 보정

### Phase 3: 썸네일 스트립 UI
8. 썸네일 스트립 HTML/CSS 구현
9. 썸네일 클릭 → `currentIndex` 변경 → 프리뷰 갱신
10. 추가(`+`) / 삭제(`×`) 버튼 기능
11. 모바일 대응 (터치 스크롤, 반응형 레이아웃)

### Phase 4: ZIP 다운로드
12. JSZip CDN 추가
13. 다중 이미지 렌더링 → ZIP 생성 → 다운로드 로직 구현
14. 프로그레스 바 UI
15. 다운로드 버튼 라벨 동적 변경

### Phase 5: 마무리
16. 프로필 모드 실제 이미지 그리드
17. 엣지 케이스 처리 (전체 삭제, 10장 초과 경고 등)
18. 모바일 전체 테스트

---

## 9. 엣지 케이스

| 상황 | 처리 |
|------|------|
| 10장 초과 업로드 시도 | 10장까지만 추가, 토스트 알림 표시 |
| 현재 보고 있는 이미지 삭제 | 다음 이미지로 이동, 마지막이면 이전으로 |
| 모든 이미지 삭제 | 초기 업로드 화면으로 복귀 |
| 대용량 이미지 10장 ZIP | 프로그레스 바로 처리 상태 표시, 비동기 처리 |
| 같은 파일명 중복 업로드 | 허용 (ZIP 내에서 파일명 충돌 시 넘버링: `photo_pfm(2).png`) |
